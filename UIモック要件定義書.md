# UIモック要件定義書（MLIT_内山氏要望準拠／最小構成）

## 背景と目的

機械が人より先に**叩き台シナリオ**を提示し、人はその中から採択する体験を1ページで実証する。具体的には、優先KPIを1つ選ぶだけで**10案**を自動生成し、社内シミュレーション（SDT）の**実測KPI**で比較して**約3案**へ自動収束する流れを最小構成で成立させる。編集は非スコープとし、「見る・送る・選ぶ」で目的達成に集中する。内山氏の「シナリオの**発想段階**まで機械がレコメンドする」意図を中核要件として扱う。 

## 用語定義

用語の揺れを防ぐため、以下を統一する。**シナリオ**は供給設計案、**KPI**は比較指標、**SDT**は社内シミュレーション環境、**アノテーション**は地図上の変更可視化である。施策は**減便／停留所統廃合／区間短縮（部分廃線）／完全廃線／DRT（デマンド型交通）ゾーン導入／時間帯見直し**の組み合わせとする。DRTは**面**（ゾーン）で表現し、線・点・面を使い分けて可読性を担保する。

## 適用範囲（スコープ）

対象は「現状表示→候補抽出10案→SDT評価→約3案推奨→人が採択」の一連であり、**手動編集・本番向け出力・最適化実装**は含めない。候補抽出アルゴリズムはブラックボックスとし、UIからは**結果の多様性と根拠の要約**のみ提示する。紙芝居デモで**体験の妥当性**を確認することを合意基準とする。

## ユースケース

担当者はGTFSと利用集計を投入し、優先KPIを1つ選んで「草案を生成」を押す。システムは**構造の異なる10案**を地図とカードで提示し、担当者はワンクリックで**10案一括をSDTへ送信**する。SDTから戻る実測KPIに基づきUIは**約3案を自動推奨**し、担当者は根拠を確認して採択する。理想像としては「**どこをどう変えるか**」の提示まで機械が踏み込むが、本モックはその入口を検証する。

## 画面構成（単一ページ・三ペイン）

左は**入力**で優先KPIの単一選択と「草案を生成」ボタンのみを置く。中央は**地図**で現状を既定表示し、カード選択に応じて**線・点・面**のアノテーションを同期ハイライトする。右は**候補フィード**で10カードを固定表示し、各カードに1行理由、状態バッジ〔未評価→評価中→達成／非達成〕、実測KPIを示す。

## ユーザーフローと状態遷移

初期表示で現状ネットワークと利用状況を描画し、生成直後の10カードは**未評価**としてKPIを伏せる。ユーザーが「SDTで評価」を押すと10案を**一括送信**し、部分応答は**評価中→達成／非達成**へ順次上書きする。優先KPIは**並び替えと推奨判定のみ再計算**し、SDTの評価値自体は固定のまま扱う。最後に「推奨のみ表示」で**約3案**へ絞り、採択へ橋渡しする。

## データ入出力

入力は**現状GTFS**（路線・時刻・停留所）と**乗降集計**を必須、ODや公共施設POIは任意強化とする。出力は**10候補の構造・1行理由・実測KPI・達成フラグ・推奨フラグ**とし、地図とカードに同一の状態を反映する。DRTはUI上の**面の見せ方のみ**必須であり、GTFS-Flex等のデータ連携は非スコープに据え置く。 

## 候補抽出ルール（多様性の担保）

10案は**地理分散（エリアが重なり過ぎない）／施策分散（線・点・面が混在）／強度分散（弱・中・強）**の3軸で重複回避する。類似案が乱立する場合は**微小摂動**で差分を付けてでも10を満たし、カード上に差分注記を必ず表示する。多様性フラグはカードツールチップで確認可能とし、説得力を落とさない運用を徹底する。

## 推奨ロジック（優先KPI×補助KPI）

推奨は選択した**優先KPI**の達成と差分優位を第一基準とし、他KPIは補助基準として閾値超過・劣後なしを確認する。UIは推奨条件の簡易式と**閾値の出典**をツールチップで開示し、ブラックボックス感を低減する。優先KPIを切替えても**評価値は固定**で**順位のみ**が即時に変わることを画面上で明示する。

## 表示・フィルタ規則

「推奨のみ表示」「達成のみ表示」トグルは**カード＝地図**で同時に適用し、未評価は常に下段にグレー表示で残す。フィルタ優先度は**推奨のみ＞達成のみ＞全件**で固定し、ゼロ件時は必ず「未評価を含める」を自動解除して一覧を保つ。並び替えは**優先KPIのスコア降順→補助KPIの合議順**を既定にする。

## 理由提示と説明責任

各カードは**1行理由**を「**指標×地理×施策**」の句型で統一し、例として「混雑率↑×末端区間×区間短縮」のように示す。理由ツールチップには評価に使った**閾値・期間・データ源**を固定で表示して、納得感を補強する。理想像である「**置くべき施策の自動提案**」に近づく説明力を、編集機能に頼らずUIの語彙で確保する。 

## 非同期処理とエラー復旧

SDT送信は非同期キューで扱い、カードには**評価%・最終更新時刻・再送**を小ボタンで表示する。タイムアウトや一部失敗時は**自動再送→手動再送**の順で明示し、失敗継続時は理由コードをカードに残す。部分到着の都度、地図とカードの状態を**同一フレーム**で更新し、ズレを許容しない。

## KPIと評価表示

生成直後はKPIを非表示とし、SDT戻りで**実測KPI**のみを掲示する。KPIは「カバー率／平均所要時間／運行コスト／サービスレベル維持率」の4軸で統一し、単位・定義・算出タイミングを仕様固定する。疑似指標や推定値は表示しない運用を徹底する。

## 受け入れ基準（UAT）

1. 取込直後に現状が地図表示されること。2) 「草案を生成」で**必ず10案**が出現し、各カードに**1行理由＋未評価バッジ**が付与されること。3) 「SDTで評価」で**10案一括評価**が動作し、**実測KPIと達成／非達成**がカード＝地図で一致反映されること。4) **優先KPIに基づく約3案の自動推奨**が表示され、「推奨のみ表示」で絞れること。5) 編集機能が存在せず、**見る・送る・選ぶ**で完結すること。

## 非機能要件（モック基準）

「草案を生成→10案表示」は**2–5秒**の見かけ時間を確保し、スケルトン表示で体感を維持する。SDT評価は非同期で進捗可視化と再送を備え、主要デスクトップブラウザ**最新2世代**で動作する。UI語彙は**候補／アノテーション／未評価／推奨**で統一し、表記ゆれを禁止する。

## 前提・制約

前提として、1) **GTFS**と**乗降集計**が投入可能であること、2) **SDT**が**10案一括評価**と**部分応答**を返せること、3) **DRTゾーンは見せ方のみ**で実データ連携を行わないことを置く。GTFS／GTFS-Flexの双方向同期や自動生成は現段階では扱わない。理想像の「ゾーン自動配置」は将来拡張とし、現行は**候補抽出結果の提示**で代替する。 

## リスクと緩和策

10案が揃わない、あるいは類似案が乱立する場合は**多様性ルールと摂動**で補完する。データ欠落時に地図が空疎になるリスクには、**段階的劣化表示**（現状のみ→現状＋簡易密度→フル情報）で説明を補う。判断基準の曖昧化には**SDT実測KPIのみで比較**し、推奨条件をUIで常時開示して恣意性を抑える。

## デモ進行（約1分）

最初に現状ネットワークと利用状況を地図に表示し、**優先KPI**を選んで「草案を生成」を押す。続いて10カードが**未評価**で出そろう様子を見せ、「SDTで評価」で**評価中→達成／非達成**へ変化させる。右上の「推奨のみ表示」で**約3案**に絞り、カード選択で**線・点・面**のアノテーションが同期ハイライトされることを確認する。最後に優先KPIを切替え、**評価値は固定で順位のみ即時更新**することを示して締める。

## UIラベルと表記統一

ボタンは「草案を生成」「SDTで評価」「推奨のみ表示」「達成のみ表示」で固定し、状態は「未評価／評価中／達成／非達成」で統一する。理由表現は**指標×地理×施策**の句型に限り、KPIは4軸の日本語名称と単位を固定する。曖昧語や英略語の混在を禁止し、初見者にも一貫した読み心地を保証する。